/**
 * This build configuration configures project to necessary files to support JEP 238: Multi-Release JAR Files.
 * https://openjdk.java.net/jeps/238
 *
 * It puts class files built for Java 9+ into META-INF/versions/9 directory.
 * It also create a manifest file with Multi-Release attribute.
 */

sourceSets {
    // The source set for classes stored in META-INF/versions/9 directory
    java9 {
        java {
            srcDirs = ['src/java9/java']
        }
    }

    main {
        java {
            srcDirs = ['src/main/java']
            exclude('**/DefaultNonNull.java')
        }
    }
}

tasks.named('compileJava9Java', JavaCompile).configure {
    options.release = 9
}

jar {
    into('META-INF/versions/9') {
        from sourceSets.java9.output
    }
    manifest {
        attributes 'Multi-Release': true
    }
}

javadoc {
    // Use the copy of DefaultNonNull whose @Target includes MODULE.
    source = sourceSets.java9.allJava + sourceSets.main.allJava
}
